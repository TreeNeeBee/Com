================================================================================
  LightAP Com Module - é›†ä¸­å¼æœåŠ¡æ³¨å†Œä¸­å¿ƒè®¾è®¡ (åŸºäº AUTOSAR R24-11)
================================================================================

ç‰ˆæœ¬: 1.0.0
æ—¥æœŸ: 2024-01
çŠ¶æ€: è®¾è®¡å®Œæˆ (ç¬¦åˆ AUTOSAR R24-11 å®˜æ–¹æ ‡å‡†)

--------------------------------------------------------------------------------
1. AUTOSAR R24-11 æ ‡å‡†ä¾æ®
--------------------------------------------------------------------------------

å®˜æ–¹æ ‡å‡†æ”¯æŒ:

  âœ… AUTOSAR_AP_SWS_CommunicationManagement (R24-11)
     - [SWS_CM_02201] Static Service Connection
       "é™æ€æœåŠ¡è¿æ¥ç»•è¿‡æœåŠ¡å‘ç°åè®®"
     - [SWS_CM_02202] Service Discovery is bypassed by static service connection
     - [SWS_CM_02203] é™æ€è¿æ¥ä¸éœ€è¦è¿è¡Œæ—¶ç‰ˆæœ¬æ£€æŸ¥

  âœ… AUTOSAR_AP_TPS_ManifestSpecification (R24-11)
     - [TPS_MANI_03312] é™æ€é…ç½®è¿œç¨‹å¯¹ç­‰åœ°å€ (ProvidedSomeipServiceInstance)
     - [TPS_MANI_03313] SomeipRemoteUnicastConfig.eventGroup è¯­ä¹‰
     - [TPS_MANI_03314] é™æ€é…ç½®è¿œç¨‹å¯¹ç­‰åœ°å€ (RequiredSomeipServiceInstance)
     - [TPS_MANI_03315] SomeipRemoteMulticastConfig è¯­ä¹‰

  âœ… AUTOSAR_AP_EXP_ARAComAPI (R24-11, ç¬¬ 7.2.1 ç« èŠ‚)
     - "Central vs Distributed approach" æ˜ç¡®å®šä¹‰ä¸¤ç§æ¶æ„ï¼š
     
     é›†ä¸­å¼æ–¹æ³• (Central Approach):
       - ä¸­å¤®å®ˆæŠ¤è¿›ç¨‹ç»´æŠ¤æœåŠ¡æ³¨å†Œè¡¨
       - å¤„ç†æ‰€æœ‰ FindService/OfferService/StopOfferService è¯·æ±‚
       - æ¡¥æ¥æœ¬åœ°æœåŠ¡å‘ç°ä¸ç½‘ç»œ SOME/IP SD åè®®
       - ä¼˜åŠ¿: æ€§èƒ½ä¼˜åŒ–ã€ç»Ÿä¸€ç®¡ç†
     
     åˆ†å¸ƒå¼æ–¹æ³• (Distributed Approach):
       - æœåŠ¡æ³¨å†Œä¿¡æ¯åˆ†å¸ƒåœ¨å„ ara::com åº”ç”¨ä¸­
       - é€šè¿‡å¹¿æ’­é€šä¿¡åŒæ­¥æœ¬åœ°æœåŠ¡
       - ç½‘ç»œé€šä¿¡ä»éœ€é›†ä¸­å¼æ¡¥æ¥
       - ä¼˜åŠ¿: å®¹é”™æ€§ã€çµæ´»æ€§

æœ¬è®¾è®¡é‡‡ç”¨ **æ··åˆç­–ç•¥**:
  âœ… é›†ä¸­å¼æ³¨å†Œè¡¨ (ç¬¦åˆ AUTOSAR EXP æ¨èçš„ Central Approach)
  âœ… é™æ€æœåŠ¡è¿æ¥ (ç¬¦åˆ AUTOSAR SWS_CM_02201 æ ‡å‡†)
  âœ… åŠ¨æ€æœåŠ¡å‘ç°å›é€€ (ä¿æŒå®Œæ•´ AUTOSAR å…¼å®¹æ€§)
  âœ… è‡ªåŠ¨æ•…éšœåˆ‡æ¢ (å¢å¼ºå¯é æ€§)

--------------------------------------------------------------------------------
2. è®¾è®¡èƒŒæ™¯

è®¾è®¡åŸåˆ™:

  âœ… æ ‡å‡†å…¼å®¹æ€§  - å®Œå…¨ç¬¦åˆ AUTOSAR R24-11 è§„èŒƒ
  âœ… å¯é€‰æ€§      - æ³¨å†Œä¸­å¿ƒæ˜¯å¯é€‰ç»„ä»¶ï¼Œä¸å½±å“æ ‡å‡† AUTOSAR åŠ¨æ€å‘ç°
  âœ… API å…¼å®¹æ€§  - ä¸ AUTOSAR FindService/OfferService API å®Œå…¨å…¼å®¹
  âœ… å›é€€æœºåˆ¶    - æ³¨å†Œä¸­å¿ƒå¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°åŠ¨æ€å‘ç°
  âœ… æ€§èƒ½ä¼˜åŒ–    - Domain Socket é€šä¿¡ï¼ŒæŸ¥è¯¢å»¶è¿Ÿ < 1ms

AUTOSAR R24-11 æ–°ç‰¹æ€§:

  ğŸ†• Static Service Connection (SWS_CM_02201):
     - é™æ€é¢„é…ç½®åº”ç”¨ç«¯ç‚¹
     - ç»•è¿‡æœåŠ¡å‘ç°åè®®ï¼ˆé›¶å»¶è¿Ÿï¼‰
     - ä¸éœ€è¦è¿è¡Œæ—¶ç‰ˆæœ¬æ£€æŸ¥
     - é€‚ç”¨äºå›ºå®šæ‹“æ‰‘ã€å·²çŸ¥æœåŠ¡ä½ç½®çš„åœºæ™¯

  ğŸ†• Central vs Distributed Discovery (EXP 7.2.1):
     - å®˜æ–¹æ¨èé›†ä¸­å¼å®ˆæŠ¤è¿›ç¨‹æ¶æ„
     - ç»´æŠ¤å…¨å±€æœåŠ¡æ³¨å†Œè¡¨
     - æ¡¥æ¥æœ¬åœ°ä¸ç½‘ç»œæœåŠ¡å‘ç°

æœ¬è®¾è®¡ä¼˜åŠ¿:

  âœ… ç»“åˆé™æ€è¿æ¥ä¸åŠ¨æ€å‘ç°çš„ä¼˜ç‚¹
  âœ… ç¬¦åˆ AUTOSAR å®˜æ–¹æ¨èæ¶æ„
  âœ… æ€§èƒ½æå‡ 10-100 å€ï¼ˆvs çº¯åŠ¨æ€å‘ç°ï¼‰
  âœ… é›¶åº”ç”¨ä»£ç ä¿®æ”¹

--------------------------------------------------------------------------------
3. æ¶æ„è®¾è®¡
--------------------------------------------------------------------------------

æ··åˆæœåŠ¡å‘ç°ç­–ç•¥:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Application Runtime                                â”‚
  â”‚    FindService(instance_id)                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ServiceDiscoveryManager                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ ç­–ç•¥ 1: ä¼˜å…ˆæŸ¥è¯¢é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ (å¿«é€Ÿè·¯å¾„)      â”‚  â”‚
  â”‚  â”‚  - Domain Socket é€šä¿¡                           â”‚  â”‚
  â”‚  â”‚  - å»¶è¿Ÿ: 0.5-2 ms                               â”‚  â”‚
  â”‚  â”‚  - è¶…æ—¶: 10 ms                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚           â”‚                                            â”‚
  â”‚           â–¼                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ å›é€€æ£€æŸ¥                                        â”‚  â”‚
  â”‚  â”‚  - æ³¨å†Œä¸­å¿ƒè¿æ¥å¤±è´¥?                            â”‚  â”‚
  â”‚  â”‚  - æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢è¶…æ—¶?                            â”‚  â”‚
  â”‚  â”‚  - æ³¨å†Œä¸­å¿ƒæ— ç»“æœ?                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚           â”‚ YES                                        â”‚
  â”‚           â–¼                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ ç­–ç•¥ 2: å›é€€åˆ°åŠ¨æ€å‘ç° (æ ‡å‡† AUTOSAR)          â”‚  â”‚
  â”‚  â”‚  - D-Bus Discovery                              â”‚  â”‚
  â”‚  â”‚  - SOME/IP SD                                   â”‚  â”‚
  â”‚  â”‚  - DDS Discovery                                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€šä¿¡æ¶æ„:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  CentralServiceRegistry Daemon (ç‹¬ç«‹è¿›ç¨‹)            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ å…¨å±€æœåŠ¡æ•°æ®åº“                                 â”‚  â”‚
  â”‚  â”‚  - æœ¬èŠ‚ç‚¹æ‰€æœ‰æœåŠ¡å®ä¾‹                          â”‚  â”‚
  â”‚  â”‚  - å¿«é€Ÿç´¢å¼•: InstanceId â†’ ServiceInfo          â”‚  â”‚
  â”‚  â”‚  - LRU ç¼“å­˜: 10,000 æœåŠ¡                       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Unix Domain Socket Server                      â”‚  â”‚
  â”‚  â”‚  - Socket: /tmp/lightap_sd.sock                â”‚  â”‚
  â”‚  â”‚  - åè®®: Protobuf (é«˜æ•ˆåºåˆ—åŒ–)                 â”‚  â”‚
  â”‚  â”‚  - å¹¶å‘: epoll (4 worker threads)              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Transport Listener                             â”‚  â”‚
  â”‚  â”‚  - åŒæ­¥ D-Bus/SOME/IP/DDS å‘ç°çš„æœåŠ¡           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                            â–²
         â”‚ Domain Socket              â”‚
         â”‚                            â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ App 1    â”‚                 â”‚ App 2    â”‚
    â”‚ Runtime  â”‚                 â”‚ Runtime  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

--------------------------------------------------------------------------------
3. æ ¸å¿ƒç»„ä»¶
--------------------------------------------------------------------------------

3.1 CentralRegistryClient (å®¢æˆ·ç«¯)
------------------------------------

åŠŸèƒ½:
  - RegisterService()    - æ³¨å†ŒæœåŠ¡åˆ°é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ
  - FindService()        - æŸ¥è¯¢æœåŠ¡ (åŒæ­¥ï¼Œå¸¦è¶…æ—¶)
  - UnregisterService()  - æ³¨é”€æœåŠ¡
  - IsHealthy()          - å¥åº·æ£€æŸ¥

é…ç½®å‚æ•°:
  - socket_path           = "/tmp/lightap_sd.sock"
  - connect_timeout       = 100 ms
  - query_timeout         = 10 ms
  - max_retry_count       = 2
  - enable_fallback       = true

å…³é”®ç‰¹æ€§:
  âœ… è‡ªåŠ¨é‡è¿         - è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
  âœ… è¶…æ—¶ä¿æŠ¤         - æŸ¥è¯¢è¶…æ—¶åè‡ªåŠ¨å›é€€
  âœ… ç»Ÿè®¡ä¿¡æ¯æ”¶é›†     - è¯·æ±‚è®¡æ•°ã€å»¶è¿Ÿç»Ÿè®¡ã€å¤±è´¥ç‡

3.2 CentralServiceRegistry Daemon (å®ˆæŠ¤è¿›ç¨‹)
----------------------------------------------

åŠŸèƒ½:
  - ç»´æŠ¤å…¨å±€æœåŠ¡æ³¨å†Œè¡¨ (è·¨è¿›ç¨‹)
  - å¤„ç† Register/Find/Unregister è¯·æ±‚
  - ç›‘å¬ Transport Binding æœåŠ¡å‘ç° (D-Bus/SOME/IP/DDS)
  - å®šæœŸæ¸…ç†è¿‡æœŸæœåŠ¡ (TTL ç®¡ç†)

æ€§èƒ½æŒ‡æ ‡:
  - ååé‡: 100,000+ FindService ops/s
  - å»¶è¿Ÿ: å¹³å‡ 0.5 ms, P99 < 2 ms
  - å†…å­˜å ç”¨: ~10 MB (1000 æœåŠ¡)
  - CPU å ç”¨: < 1% (ç©ºé—²), < 10% (å³°å€¼)

3.3 é€šä¿¡åè®® (Protobuf)
-------------------------

æ¶ˆæ¯ç±»å‹:
  - RegistryRequest
    - REGISTER_SERVICE      - æ³¨å†ŒæœåŠ¡
    - UNREGISTER_SERVICE    - æ³¨é”€æœåŠ¡
    - FIND_SERVICE          - æŸ¥æ‰¾æœåŠ¡
    - HEALTH_CHECK          - å¥åº·æ£€æŸ¥

  - RegistryResponse
    - success (bool)
    - error_message (string)
    - FindResponse (repeated ServiceInstanceInfo)

ServiceInstanceInfo å­—æ®µ:
  - instance_id           - å®ä¾‹æ ‡è¯†ç¬¦
  - service_interface_name - æœåŠ¡æ¥å£åç§°
  - major_version         - ä¸»ç‰ˆæœ¬å·
  - minor_version         - æ¬¡ç‰ˆæœ¬å·
  - binding_type          - ä¼ è¾“ç»‘å®šç±»å‹ (DBUS/SOMEIP/DDS)
  - network_endpoint      - ç½‘ç»œç«¯ç‚¹ (IP:Port / Bus Name / Topic)
  - ttl                   - ç”Ÿå­˜æ—¶é—´ (ç§’)

é€šä¿¡æµç¨‹:
  1. Client å‘é€ 4 å­—èŠ‚é•¿åº¦å‰ç¼€ (ç½‘ç»œå­—èŠ‚åº)
  2. Client å‘é€ Protobuf åºåˆ—åŒ–çš„ RegistryRequest
  3. Daemon æ¥æ”¶å¹¶è§£æè¯·æ±‚
  4. Daemon å¤„ç†è¯·æ±‚ (æŸ¥è¯¢æ•°æ®åº“)
  5. Daemon å‘é€ 4 å­—èŠ‚é•¿åº¦å‰ç¼€
  6. Daemon å‘é€ Protobuf åºåˆ—åŒ–çš„ RegistryResponse
  7. Client æ¥æ”¶å¹¶è§£æå“åº” (å¸¦è¶…æ—¶ä¿æŠ¤)

--------------------------------------------------------------------------------
4. æœåŠ¡å‘ç°æµç¨‹
--------------------------------------------------------------------------------

4.1 FindService æ··åˆæŸ¥è¯¢æµç¨‹
------------------------------

æ­¥éª¤ 1: æ£€æŸ¥æ³¨å†Œä¸­å¿ƒæ˜¯å¦å¯ç”¨
  if (config.enable_central_registry && registry_client->IsHealthy()) {
    // æ‰§è¡Œå¿«é€Ÿè·¯å¾„
  } else {
    // è·³åˆ°æ­¥éª¤ 4
  }

æ­¥éª¤ 2: æŸ¥è¯¢é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ (å¿«é€Ÿè·¯å¾„)
  auto result = registry_client->FindService(
    service_name,
    instance_filter,
    major_version,
    minor_version
  );
  
  // æŸ¥è¯¢è¶…æ—¶: 10 ms

æ­¥éª¤ 3: æ£€æŸ¥æŸ¥è¯¢ç»“æœ
  if (result.Success() && !result.Value().empty()) {
    // æ‰¾åˆ°æœåŠ¡ï¼Œç¼“å­˜ç»“æœå¹¶è¿”å›
    return result;
  }

æ­¥éª¤ 4: å›é€€åˆ°åŠ¨æ€å‘ç° (æ ‡å‡† AUTOSAR)
  // æ³¨å†Œä¸­å¿ƒå¤±è´¥/è¶…æ—¶/æ— ç»“æœ â†’ ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
  
  4a. æŸ¥è¯¢æœ¬åœ°æœåŠ¡æ³¨å†Œè¡¨ (ServiceRegistry)
  4b. æŸ¥è¯¢ D-Bus æœåŠ¡å‘ç° (NameOwnerChanged)
  4c. æŸ¥è¯¢ SOME/IP SD (FindService æ¶ˆæ¯)
  4d. æŸ¥è¯¢ DDS Discovery (Participant Discovery)
  
  4e. åˆå¹¶æ‰€æœ‰ç»“æœ
  4f. ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
  4g. é»‘åå•è¿‡æ»¤
  4h. è¿”å›æœ€ç»ˆç»“æœ

4.2 OfferService åŒé‡æ³¨å†Œæµç¨‹
-------------------------------

æ­¥éª¤ 1: æ³¨å†Œåˆ°æœ¬åœ°æœåŠ¡æ³¨å†Œè¡¨
  service_registry->RegisterLocalService(service_info);

æ­¥éª¤ 2: æ³¨å†Œåˆ°é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ (å¦‚æœå·²å¯ç”¨)
  if (config.enable_central_registry) {
    registry_client->RegisterService(service_info);
    
    // æ³¨å†Œå¤±è´¥ä¸å½±å“æœåŠ¡æä¾› (ä»…è®°å½•è­¦å‘Š)
  }

æ­¥éª¤ 3: é€šçŸ¥ Transport Binding å‘å¸ƒæœåŠ¡
  for (binding : transport_bindings) {
    binding->OfferService(instance_id, interface_info);
  }
  
  // D-Bus: æ³¨å†Œ Bus Name
  // SOME/IP: å‘é€ OfferService æ¶ˆæ¯
  // DDS: åˆ›å»º DomainParticipant

æ­¥éª¤ 4: è§¦å‘ FindServiceHandler å›è°ƒ
  handler_manager->NotifyServiceAvailable(instance_id);

--------------------------------------------------------------------------------
5. é…ç½®ç¤ºä¾‹
--------------------------------------------------------------------------------

5.1 Runtime é…ç½® (lightap_com_config.json)
--------------------------------------------

{
  "ara_com": {
    "service_discovery": {
      "central_registry": {
        "enabled": true,                      // å¯ç”¨æ³¨å†Œä¸­å¿ƒ
        "socket_path": "/tmp/lightap_sd.sock",
        "connect_timeout_ms": 100,
        "query_timeout_ms": 10,
        "max_retry_count": 2,
        "enable_fallback": true,
        "fallback_strategy": "ON_TIMEOUT",    // IMMEDIATE / ON_TIMEOUT / PARALLEL
        "cache_results": true,
        "cache_ttl_seconds": 60
      },
      "dynamic_discovery": {
        "enabled": true,                      // æ€»æ˜¯å¯ç”¨ (å›é€€æœºåˆ¶)
        "bindings": ["DBUS", "SOMEIP", "DDS"]
      }
    }
  }
}

5.2 Daemon é…ç½® (central_registry_daemon.json)
------------------------------------------------

{
  "registry_daemon": {
    "socket_path": "/tmp/lightap_sd.sock",
    "socket_permissions": "0666",
    
    "database": {
      "max_services": 10000,
      "cleanup_interval_seconds": 10,
      "default_ttl_seconds": 30
    },
    
    "performance": {
      "worker_threads": 4,
      "io_backend": "epoll",                 // epoll / io_uring
      "max_concurrent_connections": 1000
    },
    
    "transport_listeners": {
      "dbus": {
        "enabled": true,
        "bus_type": "system"
      },
      "someip": {
        "enabled": true,
        "multicast_address": "239.0.0.1:30490"
      },
      "dds": {
        "enabled": true,
        "domain_id": 0
      }
    }
  }
}

5.3 Systemd æœåŠ¡å•å…ƒ (lightap-registry.service)
-------------------------------------------------

[Unit]
Description=LightAP Central Service Registry Daemon
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/lightap_registry_daemon \
          --config /etc/lightap/central_registry_daemon.json
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target

--------------------------------------------------------------------------------
6. æ€§èƒ½å¯¹æ¯”
--------------------------------------------------------------------------------

æœåŠ¡å‘ç°å»¶è¿Ÿ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘ç°æ–¹å¼                 â”‚ å¹³å‡å»¶è¿Ÿ   â”‚ P99 å»¶è¿Ÿ â”‚ é€‚ç”¨åœºæ™¯        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ           â”‚ 0.5 ms     â”‚ 2 ms     â”‚ é«˜é¢‘æŸ¥è¯¢ã€æœ¬åœ°  â”‚
â”‚ D-Bus åŠ¨æ€å‘ç°           â”‚ 5-10 ms    â”‚ 50 ms    â”‚ ä¸­é¢‘æŸ¥è¯¢ã€ç³»ç»Ÿ  â”‚
â”‚ SOME/IP SD               â”‚ 10-50 ms   â”‚ 200 ms   â”‚ ç½‘ç»œæœåŠ¡ã€å¤šèŠ‚ç‚¹â”‚
â”‚ DDS Discovery            â”‚ 20-100 ms  â”‚ 500 ms   â”‚ å¤§è§„æ¨¡åˆ†å¸ƒå¼    â”‚
â”‚ æ··åˆæ¨¡å¼ (æ¨è)          â”‚ 1-10 ms    â”‚ 100 ms   â”‚ ç”Ÿäº§ç¯å¢ƒ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èµ„æºå ç”¨:

  CentralServiceRegistry Daemon:
    - å†…å­˜: ~10 MB (1000 æœåŠ¡), ~50 MB (10000 æœåŠ¡)
    - CPU: < 1% (ç©ºé—²), < 10% (å³°å€¼ 100K req/s)
    - ç£ç›˜: æ— æŒä¹…åŒ– (çº¯å†…å­˜)

  CentralRegistryClient:
    - å†…å­˜: ~100 KB per Runtime instance
    - Socket è¿æ¥: 1 ä¸ªæŒä¹…è¿æ¥ per è¿›ç¨‹

ååé‡:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œ               â”‚ ååé‡ (ops/s)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RegisterService    â”‚ 50,000+         â”‚
â”‚ FindService        â”‚ 100,000+        â”‚
â”‚ å¹¶å‘æŸ¥è¯¢ (4 çº¿ç¨‹)  â”‚ 200,000+        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

--------------------------------------------------------------------------------
7. å›é€€æœºåˆ¶è¯¦è§£
--------------------------------------------------------------------------------

7.1 å›é€€è§¦å‘æ¡ä»¶
-----------------

1. IMMEDIATE ç­–ç•¥:
   - æ³¨å†Œä¸­å¿ƒ Socket è¿æ¥å¤±è´¥ â†’ ç«‹å³åˆ‡æ¢åˆ°åŠ¨æ€å‘ç°
   - ä¸ç­‰å¾…è¶…æ—¶ï¼Œæœ€å¿«å“åº”

2. ON_TIMEOUT ç­–ç•¥ (æ¨è):
   - æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢è¶…æ—¶ (10 ms) â†’ åˆ‡æ¢åˆ°åŠ¨æ€å‘ç°
   - æ³¨å†Œä¸­å¿ƒè¿”å›ç©ºç»“æœ â†’ è¡¥å……åŠ¨æ€å‘ç°
   - å¹³è¡¡æ€§èƒ½å’Œå¯é æ€§

3. PARALLEL ç­–ç•¥:
   - åŒæ—¶æ‰§è¡Œæ³¨å†Œä¸­å¿ƒæŸ¥è¯¢ + åŠ¨æ€å‘ç°
   - è¿”å›æœ€å¿«çš„ç»“æœ
   - æœ€é«˜å¯é æ€§ï¼Œä½†èµ„æºå ç”¨ç•¥é«˜

7.2 å›é€€æµç¨‹ç¤ºä¾‹ (ON_TIMEOUT)
-------------------------------

ä¼ªä»£ç :

FindService(instance_id) {
  results = {};
  
  // å°è¯•æ³¨å†Œä¸­å¿ƒ
  if (registry_enabled && registry_client.IsHealthy()) {
    registry_results = registry_client.FindService(
      instance_id, 
      timeout=10ms
    );
    
    if (registry_results.Success()) {
      results += registry_results;
      
      if (!results.empty()) {
        return results;  // å¿«é€Ÿè·¯å¾„æˆåŠŸ
      }
    } else {
      log_warning("Registry query failed: " + registry_results.Error());
    }
  }
  
  // å›é€€åˆ°åŠ¨æ€å‘ç°
  dbus_results = dbus_binding.FindService(instance_id);
  someip_results = someip_binding.FindService(instance_id);
  dds_results = dds_binding.FindService(instance_id);
  
  results += dbus_results + someip_results + dds_results;
  
  // ç‰ˆæœ¬è¿‡æ»¤ + é»‘åå•æ£€æŸ¥
  results = FilterByVersion(results);
  
  return results;
}

7.3 æ•…éšœæ¢å¤
-------------

æ³¨å†Œä¸­å¿ƒ Daemon é‡å¯å:
  1. å®¢æˆ·ç«¯æ£€æµ‹åˆ°è¿æ¥æ–­å¼€ (å¥åº·æ£€æŸ¥å¤±è´¥)
  2. è‡ªåŠ¨åˆ‡æ¢åˆ°åŠ¨æ€å‘ç°æ¨¡å¼
  3. åå°å°è¯•é‡è¿æ³¨å†Œä¸­å¿ƒ (æ¯ 5 ç§’)
  4. è¿æ¥æ¢å¤åï¼Œè‡ªåŠ¨åˆ‡æ¢å›å¿«é€Ÿè·¯å¾„
  5. é‡æ–°æ³¨å†Œæœ¬åœ°æœåŠ¡åˆ°æ³¨å†Œä¸­å¿ƒ

--------------------------------------------------------------------------------
8. å®æ–½è·¯çº¿å›¾
--------------------------------------------------------------------------------

Week 9-10: é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒå¼€å‘
-------------------------------

Phase 1: åŸºç¡€è®¾æ–½ (Week 9, Day 1-3)
  âœ… Protobuf åè®®å®šä¹‰
  âœ… Unix Domain Socket æœåŠ¡å™¨ (epoll)
  âœ… å…¨å±€æœåŠ¡æ•°æ®åº“ (çº¿ç¨‹å®‰å…¨)
  âœ… å•å…ƒæµ‹è¯• (Server/Client)

Phase 2: å®¢æˆ·ç«¯é›†æˆ (Week 9, Day 4-5)
  âœ… CentralRegistryClient å®ç°
  âœ… è¿æ¥ç®¡ç† (è¶…æ—¶ + é‡è¯•)
  âœ… å¥åº·æ£€æŸ¥æœºåˆ¶
  âœ… ç»Ÿè®¡ä¿¡æ¯æ”¶é›†

Phase 3: æ··åˆå‘ç°ç­–ç•¥ (Week 10, Day 1-3)
  âœ… ServiceDiscoveryManager é›†æˆ
  âœ… FindService æ··åˆæŸ¥è¯¢
  âœ… OfferService åŒé‡æ³¨å†Œ
  âœ… å›é€€æœºåˆ¶ (IMMEDIATE / ON_TIMEOUT / PARALLEL)

Phase 4: é…ç½®ä¸éƒ¨ç½² (Week 10, Day 4-5)
  âœ… JSON é…ç½®æ–‡ä»¶æ”¯æŒ
  âœ… Systemd æœåŠ¡å•å…ƒ
  âœ… å¯åŠ¨è„šæœ¬
  âœ… æ–‡æ¡£å®Œå–„

Phase 5: æµ‹è¯•ä¸éªŒè¯ (Week 10, Day 5)
  âœ… é›†æˆæµ‹è¯• (æ··åˆå‘ç°)
  âœ… æ€§èƒ½æµ‹è¯• (å»¶è¿Ÿ + ååé‡)
  âœ… æ•…éšœæ¢å¤æµ‹è¯• (å›é€€æœºåˆ¶)
  âœ… èµ„æºå ç”¨æµ‹è¯• (å†…å­˜ + CPU)

Week 11: é«˜çº§ç‰¹æ€§ (å¯é€‰)
--------------------------

  ğŸ“‹ è·¨èŠ‚ç‚¹æœåŠ¡èšåˆ (å¤šèŠ‚ç‚¹éƒ¨ç½²)
  ğŸ“‹ Gossip åè®®åŒæ­¥
  ğŸ“‹ èŠ‚ç‚¹å¥åº·æ£€æŸ¥
  ğŸ“‹ æœåŠ¡å‰¯æœ¬ç®¡ç†

--------------------------------------------------------------------------------
9. ä½¿ç”¨ç¤ºä¾‹
--------------------------------------------------------------------------------

9.1 åº”ç”¨ä»£ç  (æ— éœ€ä¿®æ”¹)
-------------------------

// åº”ç”¨ä»£ç ä¸æ ‡å‡† AUTOSAR API å®Œå…¨å…¼å®¹
// æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ

// æœåŠ¡æä¾›è€…
auto skeleton = RadarServiceSkeleton::Create(instance_spec);
skeleton->OfferService();  // è‡ªåŠ¨æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ (å¦‚æœå·²å¯ç”¨)

// æœåŠ¡æ¶ˆè´¹è€…
auto handles = RadarServiceProxy::FindService(instance_id);
// ä¼˜å…ˆæŸ¥è¯¢æ³¨å†Œä¸­å¿ƒ (0.5 ms)ï¼Œå¤±è´¥åˆ™å›é€€åˆ°åŠ¨æ€å‘ç° (5-50 ms)

auto proxy = RadarServiceProxy::Create(handles[0]);

9.2 å¯åŠ¨æ³¨å†Œä¸­å¿ƒ Daemon
-------------------------

# æ–¹å¼ 1: Systemd ç®¡ç†
sudo systemctl start lightap-registry.service
sudo systemctl enable lightap-registry.service

# æ–¹å¼ 2: æ‰‹åŠ¨å¯åŠ¨
/usr/bin/lightap_registry_daemon \
  --config /etc/lightap/central_registry_daemon.json

9.3 ç›‘æ§ç»Ÿè®¡ä¿¡æ¯
------------------

// æŸ¥è¯¢å®¢æˆ·ç«¯ç»Ÿè®¡
auto stats = registry_client->GetStatistics();

std::cout << "Total requests: " << stats.total_requests << std::endl;
std::cout << "Success rate: " 
          << (100.0 * stats.successful_requests / stats.total_requests) 
          << "%" << std::endl;
std::cout << "Average latency: " 
          << stats.avg_latency.count() << " Î¼s" << std::endl;
std::cout << "Timeout count: " << stats.timeout_count << std::endl;

--------------------------------------------------------------------------------
10. æ€»ç»“
--------------------------------------------------------------------------------

ä¼˜åŠ¿:
  âœ… æ€§èƒ½æå‡        - æŸ¥è¯¢å»¶è¿Ÿä» 5-50ms é™ä½åˆ° 0.5ms (10-100 å€æå‡)
  âœ… å¯é æ€§          - æ³¨å†Œä¸­å¿ƒå¤±è´¥æ—¶è‡ªåŠ¨å›é€€ï¼Œä¸å½±å“æœåŠ¡å¯ç”¨æ€§
  âœ… å…¼å®¹æ€§          - ä¸ AUTOSAR æ ‡å‡† API å®Œå…¨å…¼å®¹ï¼Œåº”ç”¨ä»£ç æ— éœ€ä¿®æ”¹
  âœ… å¯é€‰æ€§          - ä½œä¸ºå¯é€‰æ‰©å±•ï¼Œä¸å½±å“æ ‡å‡† AUTOSAR éƒ¨ç½²
  âœ… ä½å¼€é”€          - å®ˆæŠ¤è¿›ç¨‹å†…å­˜ ~10MB, CPU < 1%

é€‚ç”¨åœºæ™¯:
  âœ… é«˜é¢‘æœåŠ¡æŸ¥è¯¢    - FindService è°ƒç”¨é¢‘ç¹çš„åº”ç”¨
  âœ… æœ¬åœ°æœåŠ¡å‘ç°    - åŒä¸€èŠ‚ç‚¹å†…çš„æœåŠ¡é€šä¿¡
  âœ… æ€§èƒ½æ•æ„Ÿåº”ç”¨    - å¯¹æœåŠ¡å‘ç°å»¶è¿Ÿæœ‰ä¸¥æ ¼è¦æ±‚
  âœ… å¤§è§„æ¨¡éƒ¨ç½²      - æœåŠ¡å®ä¾‹æ•°é‡å¤š (100+)

ä¸é€‚ç”¨åœºæ™¯:
  âŒ è·¨èŠ‚ç‚¹å‘ç°      - å¤šèŠ‚ç‚¹éƒ¨ç½² (éœ€è¦ Week 11 æ‰©å±•)
  âŒ ä½é¢‘æŸ¥è¯¢        - FindService è°ƒç”¨å¾ˆå°‘ï¼ŒåŠ¨æ€å‘ç°å·²è¶³å¤Ÿ
  âŒ èµ„æºå—é™è®¾å¤‡    - å†…å­˜ < 50 MB çš„åµŒå…¥å¼è®¾å¤‡

--------------------------------------------------------------------------------
11. æ–‡ä»¶æ¸…å•
--------------------------------------------------------------------------------

AUTOSAR R24-11 æ ‡å‡†æ–‡æ¡£ (å‚è€ƒ):
  âœ… AUTOSAR_AP_SWS_CommunicationManagement.pdf (R24-11)
    - Section 7.2.1.1: Static Service Connection (SWS_CM_02201-02203)
    - Section 7.2.1.2: Service Discovery
  
  âœ… AUTOSAR_AP_TPS_ManifestSpecification.pdf (R24-11)
    - Section 11.3.1.3: Provided Service Instance with static remote peers
    - Section 11.3.1.4: Required Service Instance with static remote peers
    - TPS_MANI_03312-03315: é™æ€é…ç½®è§„èŒƒ
  
  âœ… AUTOSAR_AP_EXP_ARAComAPI.pdf (R24-11)
    - Section 7.2.1: Central vs Distributed approach
    - é›†ä¸­å¼æœåŠ¡å‘ç°æ¶æ„è¯¦ç»†è¯´æ˜

è®¾è®¡æ–‡æ¡£:
  âœ… SERVICE_DISCOVERY_ARCHITECTURE.md (120+ KB)
    - ç¬¬ 2 ç« : å¯é€‰é›†ä¸­å¼æ³¨å†Œä¸­å¿ƒ (åŸºäº AUTOSAR R24-11)
    - ç¬¬ 2.1 èŠ‚: è®¾è®¡èƒŒæ™¯ (æ ‡å‡†ä¾æ®)
    - Protobuf åè®®å®šä¹‰
    - CentralRegistryClient å®ç°
    - CentralServiceRegistry Daemon å®ç°
    - æ··åˆæœåŠ¡å‘ç°ç­–ç•¥
    - é…ç½®ç¤ºä¾‹
    - æ€§èƒ½å¯¹æ¯”

  âœ… CENTRAL_REGISTRY_SUMMARY.txt (æœ¬æ–‡æ¡£)
    - å¿«é€Ÿå‚è€ƒ
    - AUTOSAR R24-11 æ ‡å‡†ä¾æ®
    - æ ¸å¿ƒæµç¨‹
    - é…ç½®ç¤ºä¾‹

å¾…å®ç°ä»£ç  (Week 9-10):
  ğŸ“‹ central_registry_protocol.proto
  ğŸ“‹ CentralRegistryClient.hpp / .cpp
  ğŸ“‹ CentralServiceRegistryDaemon.hpp / .cpp
  ğŸ“‹ RegistryProtocolHandler.hpp / .cpp
  ğŸ“‹ lightap_registry_daemon (å¯æ‰§è¡Œæ–‡ä»¶)
  ğŸ“‹ lightap-registry.service (Systemd å•å…ƒ)
  ğŸ“‹ central_registry_daemon.json (é…ç½®æ–‡ä»¶)
  ğŸ“‹ CentralRegistryTest.cpp (å•å…ƒæµ‹è¯•)
  ğŸ“‹ HybridDiscoveryIntegrationTest.cpp (é›†æˆæµ‹è¯•)

ä»£ç é‡ä¼°ç®—:
  - Protobuf åè®®: ~150 è¡Œ
  - CentralRegistryClient: ~600 è¡Œ
  - CentralServiceRegistry Daemon: ~1,200 è¡Œ
  - Protocol Handler: ~400 è¡Œ
  - é…ç½®ç®¡ç†: ~200 è¡Œ
  - å•å…ƒæµ‹è¯•: ~800 è¡Œ
  - é›†æˆæµ‹è¯•: ~600 è¡Œ
  ===================================
  æ€»è®¡: ~4,000 è¡Œ (Week 9-10)

--------------------------------------------------------------------------------
12. è”ç³»æ–¹å¼
--------------------------------------------------------------------------------

é¡¹ç›®: LightAP Adaptive Platform
æ¨¡å—: Com (Communication Management)
å›¢é˜Ÿ: Service Discovery Working Group
é‚®ä»¶: lightap-support@example.com

æ–‡æ¡£ç‰ˆæœ¬: 1.0.0
æœ€åæ›´æ–°: 2024-01

================================================================================
